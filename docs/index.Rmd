---
title: "COVID-19 ITALIA"
author: "by Enzo Albanese"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    smooth_scroll: true
    includes:
      in_header: ga_script.html
      social: menu
---
```{r}
library(flexdashboard)
library(dplyr)
library(utils)
#library(httr)
library(RCurl)
library(plotly)
library(tidyr)


# confirmed_global <- utils::read.csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv", stringsAsFactors = FALSE)


# coronavirus <- utils::read.csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports/06-27-2021.csv", stringsAsFactors = FALSE)

coronavirus <- utils::read.csv("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports/02-15-2023.csv", stringsAsFactors = FALSE)


df_italy <- utils::read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-andamento-nazionale/dpc-covid19-ita-andamento-nazionale.csv", stringsAsFactors = FALSE)

df_italy_region <- utils::read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni.csv", stringsAsFactors = FALSE)

df_italy_region_latest <- utils::read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-regioni/dpc-covid19-ita-regioni-latest.csv", stringsAsFactors = FALSE)

df_italy_province <- utils::read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-province/dpc-covid19-ita-province.csv", stringsAsFactors = FALSE)

df_italy_province_latest <- utils::read.csv("https://raw.githubusercontent.com/pcm-dpc/COVID-19/master/dati-province/dpc-covid19-ita-province-latest.csv", stringsAsFactors = FALSE)


confirmed_color <- "blue"
casi_totali_color <- "blue"
active_color <- "red"
positivi_color <- "red"
recovered_color <- "orange"
guariti_color <- "forestgreen"
death_color <- "black"
deceduti_color <- "black"
nuovi_positivi_color <- "purple"

isolamento_color <- "yellow"
ricoverati_color <- "orange"
terapia_color <- "#990000"
tamponi_color <- "violet"
casi_testati_color <- "green"


#rm(list = ls())

```

ITALIA
=====================================  
Row
-------------------------------------
### Casi totali in Italia {.value-box}

```{r}

valueBox(value = paste(format(sum(df_italy_region_latest$totale_casi), big.mark = "."), "", sep = " "), 
         caption = "Totale casi", 
         icon = "fas fa-user-md", 
         color = casi_totali_color)

```

### Positivi {.value-box}

```{r}

valueBox(value = paste(format(sum(df_italy_region_latest$totale_positivi), big.mark = "."),
         " (", round(100 * sum(df_italy_region_latest$totale_positivi) / sum(df_italy_region_latest$totale_casi), 1), "%)", "", sep = " "), 
         caption = "Totale positivi", 
         icon = "fas fa-user-md", 
         color = positivi_color)

```

### Guariti {.value-box}

```{r}
valueBox(value = paste(format(sum(df_italy_region_latest$dimessi_guariti), big.mark = "."),
         " (", round(100 * sum(df_italy_region_latest$dimessi_guariti) / sum(df_italy_region_latest$totale_casi), 1), "%)", "", sep = " "),
         caption = "Totale guariti", 
         icon = "fas fa-heartbeat", 
         color = guariti_color)
```

### Decessi {.value-box}

```{r}
valueBox(value = paste(format(sum(df_italy_region_latest$deceduti), big.mark = "."),
           " (", round(100 * sum(df_italy_region_latest$deceduti) / sum(df_italy_region_latest$totale_casi), 1), "%)", "", sep = " "),
         caption = "Totale deceduti", 
         icon = "fas fa-heart-broken", 
         color = deceduti_color)
```

Row
-------------------------------------

### NUOVI CONTAGI, NUOVI GUARITI, NUOVI DECESSI e VARIAZIONE TOTALE POSITIVI in ITALIA (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy %>%
    arrange(as.Date(data)) %>%
  mutate(variazione_dimessi_guariti = dimessi_guariti - lag(dimessi_guariti),
         #Rate_percent_dimessi_guariti = (variazione_dimessi_guariti)/dimessi_guariti * 100,
         variazione_deceduti = deceduti - lag(deceduti)) %>%
         #Rate_percent_deceduti = (variazione_deceduti)/deceduti * 100,
         #variazione_totale_casi = totale_casi - lag(totale_casi),
         #Rate_percent_totale_casi = (variazione_totale_casi)/totale_casi * 100,
         #variazione_totale_casi = totale_casi - lag(totale_casi),
         #Rate_percent_totale_casi = (variazione_totale_casi)/totale_casi * 100) %>%
plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "NUOVI CONTAGI",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_dimessi_guariti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_deceduti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
    plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

### Andamento giornaliero TOTALE CASI, POSITIVI, GUARITI e DECESSI in ITALIA (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

plotly::plot_ly(data = df_italy) %>% config(displayModeBar = FALSE) %>%
    plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_casi,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Totale casi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ dimessi_guariti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ deceduti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
  plotly::add_annotations(
    x = as.Date("2020-02-21"),
    y = 1,
    text = paste("Primo caso"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    ax = -90,
    ay = -90
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-02-24"),
    y = 3,
    text = paste("Primo deceduto"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    ax = 40,
    ay = -110
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-03-18"),
    y = 14,
    text = paste(
      "Nuove misure",
      "",
      "Cura Italia"
    ),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    ax = -10,
    ay = -130
  ) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

Row
-------------------------------------

### NUOVI CONTAGI, TAMPONI GIORNALIERI, CASI TESTATI GIORNALIERI (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

 df_italy %>%
  dplyr::mutate(variazione_casi_testati = casi_testati - lag(casi_testati), 
                variazione_tamponi = tamponi - lag(tamponi),
                variazione_nuovi_positivi = nuovi_positivi - lag(nuovi_positivi)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_casi_testati,
                    text = ~ variazione_casi_testati,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Casi testati giornalieri",
                    line = list(color = nuovi_positivi_color),
                    marker = list(color = nuovi_positivi_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_tamponi,
                    text = ~ variazione_tamponi,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Tamponi giornalieri",
                    line = list(color = tamponi_color),
                    marker = list(color = tamponi_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    text = ~ nuovi_positivi,
                    hovertemplate = "%{y}",
                    textposition = 'auto',
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color),
                    type = "scatter", mode = "lines+markers") %>%
  plotly::layout(title = "",
                 yaxis = list(title = ""),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")


```

Row
-------------------------------------
### Distribuzione TOTALE POSITIVI, GUARITI E DECESSI per REGIONE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(data == max(data)) %>%
  dplyr::group_by(denominazione_regione, dimessi_guariti, deceduti) %>%
  dplyr::summarise(totale_positivi = sum(totale_positivi)) %>%
  #plot_ly(data = df_italy_region_latest[, c(4, 11, 14, 15)]) %>% 
  plot_ly() %>% config(displayModeBar = FALSE) %>%
  add_trace(x = ~ denominazione_regione,
                    y = ~ totale_positivi,
                    #text = ~ totale_positivi,
                    #textposition = 'auto',
                    name = "Totale positivi",
                    #line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
 add_trace(x = ~ denominazione_regione,
                    y = ~ dimessi_guariti,
                    #text = ~ totale_guariti,
                    #textposition = 'auto',
                    name = "Totale guariti",
                    #line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
  add_trace(x = ~ denominazione_regione,
                    y = ~ deceduti,
                    #text = ~ totale_deceduti,
                    #textposition = 'auto',
                    name = "Totale decessi",
                    #line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%

  layout(legend = list(x = .6, y = 0.9),
    type = "bar", barmode = "stack", mode = "lines+markers", bargap = 0.15, bargroupgap = 0.1,
    yaxis = list(title = "Numero di casi"),
    xaxis = list(title = ""),
    hovermode = "x unified",
    margin = list(
      # l = 60,
      # r = 40,
      b = 10,
      t = 10,
      pad = 2))

```

### NUOVI CONTAGI per REGIONE (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_region %>%
    dplyr::group_by(denominazione_regione, data = as.Date(data)) %>%
  dplyr::summarise(total = sum(nuovi_positivi)) %>%
  tidyr::pivot_wider(
    names_from = denominazione_regione,
    values_from = total) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(
    x = ~ as.Date(data),
    y = ~ Sicilia,
    type = "scatter",
    mode = "lines+markers",
    name = "Sicilia"
  ) %>%
  plotly::add_trace(
    x = ~ as.Date(data),
    y = ~ Lombardia,
    type = "scatter",
    mode = "lines+markers",
    name = "Lombardia"
  ) %>%
  plotly::add_trace(
    x = ~ as.Date(data),
    y = ~ Veneto,
    type = "scatter",
    mode = "lines+markers",
    name = "Veneto"
  ) %>%
  plotly::add_trace(
    x = ~ as.Date(data),
    y = ~ Piemonte,
    type = "scatter",
    mode = "lines+markers",
    name = "Piemonte"
  ) %>%
  plotly::add_trace(
    x = ~ as.Date(data),
    y = ~ Lazio,
    type = "scatter",
    mode = "lines+markers",
    name = "Lazio"
  ) %>%
  plotly::layout(
    title = "",
    legend = list(x = 0.4, y = 0.9),
    yaxis = list(title = "Numero di positivi"),
    xaxis = list(title = "data"),
    # paper_bgcolor = "black",
    # plot_bgcolor = "black",
    # font = list(color = 'white'),
    hovermode = "x unified",
    margin = list(
      # l = 60,
      # r = 40,
      b = 10,
      t = 10,
      pad = 2
    )
  )

``` 

Row
-------------------------------------
    
### Andamento giornaliero RICOVERATI, IN TERAPIA INTENSIVA e IN ISOLAMENTO DOMICILIARE in ITALIA (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}
plotly::plot_ly(data = df_italy) %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ terapia_intensiva,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Ricoverati in terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ isolamento_domiciliare,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "In isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
```

### NUOVI RICOVERATI, NUOVI IN TERAPIA INTENSIVA E NUOVI IN ISOLAMENTO DOMICILIARE in ITALIA (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy %>%
    arrange(data) %>%
  mutate(variazione_ricoverati_con_sintomi = ricoverati_con_sintomi - lag(ricoverati_con_sintomi),
        # Rate_percent_ricoverati_con_sintomi = (variazione_ricoverati_con_sintomi / ricoverati_con_sintomi)/ricoverati_con_sintomi * 100,
         variazione_terapia_intensiva = terapia_intensiva - lag(terapia_intensiva),
         #Rate_percent_terapia_intensiva = (variazione_terapia_intensiva)/terapia_intensiva * 100,
         variazione_isolamento_domiciliare = isolamento_domiciliare - lag(isolamento_domiciliare)) %>%
         #Rate_percent_isolamento_domiciliare = (variazione_isolamento_domiciliare)/isolamento_domiciliare * 100) %>%



plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%

  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_terapia_intensiva,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi in terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
  
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_isolamento_domiciliare,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi in isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  
      plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

SICILIA
=====================================  
Row
-------------------------------------
    
### Casi totali in Sicilia {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[17, 18], big.mark = "."), "", sep = " "), 
         caption = "Totale casi", 
         icon = "fas fa-user-md", 
         color = casi_totali_color)

```

### Positivi {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[17, 11], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[17, 11]) / sum(df_italy_region_latest[17, 18]), 1), "%)", "", sep = " "), 
         caption = "Totale positivi", 
         icon = "fas fa-user-md", 
         color = positivi_color)


```

### Guariti {.value-box}

```{r}
valueBox(value = paste(format(df_italy_region_latest[17, 14], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[17, 14]) / sum(df_italy_region_latest[17, 18]), 1), "%)", "", sep = " "),
         caption = "Totale guariti", 
         icon = "fas fa-user-md", 
         color = guariti_color)
```

### Decessi {.value-box}

```{r}
valueBox(value = paste(format(df_italy_region_latest[17, 15], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[17, 15]) / sum(df_italy_region_latest[17, 18]), 1), "%)", "", sep = " "),
         caption = "Totale deceduti", 
         icon = "fas fa-heart-broken", 
         color = deceduti_color)

```

Row {data-height=400}
-------------------------------------
    
### Distribuzione TOTALE CASI PROVINCE SICILIANE (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_province %>% 
  dplyr::filter(denominazione_regione == "Sicilia") %>%
  dplyr::group_by(denominazione_provincia,data,totale_casi) %>%
  #dplyr::filter(data == as.Date(Sys.Date()-1)) %>%
  #dplyr::filter(data == max(data)) %>%
  #dplyr::summarise(total = sum(totale_casi)) %>%
  
  #tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>%
  plot_ly(labels = ~ denominazione_provincia, values = ~ totale_casi, 
          textposition = 'inside',
          textinfo = 'label+percent',
          insidetextfont = list(color = '#FFFFFF'),
          type = 'pie') %>%
  layout(title = '',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE)) %>% 
  hide_legend()

```
    
### NUOVI CONTAGI in SICILIA (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Sicilia") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                  y = ~ nuovi_positivi,
                  text = ~ nuovi_positivi,
                  textposition = 'auto',
                  name = "Nuovi contagi",
                  line = list(color = casi_totali_color),
                  marker = list(color = casi_totali_color),
                  type = "scatter", mode = "lines+markers") %>%
    plotly::layout(yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = "", hovermode = "x unified",
     categoryorder = "array",
     categoryarray = ~ variazione_totale_positivi))
     
  
```

Row {data-height=400}
-------------------------------------
    
### NUOVI CONTAGI, NUOVI TAMPONI E NUOVI CASI TESTATI in SICILIA (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Sicilia") %>%
  dplyr::mutate(variazione_casi_testati = casi_testati - lag(casi_testati), 
                variazione_tamponi = tamponi - lag(tamponi),
                variazione_nuovi_positivi = nuovi_positivi - lag(nuovi_positivi)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_casi_testati,
                    text = ~ variazione_casi_testati,
                    hovertemplate = "%{text}",
     #hovertemplate = "%{fullData.name} sold: %{y}<br>Percentage: %{text} <extra></extra>"
                    textposition = 'auto',
                    name = "Casi testati giornalieri",
                    line = list(color = casi_testati_color),
                    marker = list(color = casi_testati_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_tamponi,
                    text = ~ variazione_tamponi,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Tamponi giornalieri",
                    line = list(color = tamponi_color),
                    marker = list(color = tamponi_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    text = ~ nuovi_positivi,
                    hovertemplate = "%{y}",
                    textposition = 'auto',
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  # plotly::add_trace(x = ~ as.Date(data),
  #                   y = ~ variazione_totale_positivi,
  #                   text = ~ variazione_totale_positivi,
  #                   hovertemplate = "%{y}",
  #                   textposition = 'auto',
  #                   name = "variazione totale positivi",
  #                   line = list(color = positivi_color),
  #                   marker = list(color = positivi_color),
  #                   type = "scatter", mode = "lines+markers") %>%
  
  plotly::layout(title = "",
                 yaxis = list(title = ""),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```
    
### NUOVI CONTAGI PROVINCE SICILIANE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_province %>%
  dplyr::filter(denominazione_regione == "Sicilia") %>%
  dplyr::arrange(denominazione_provincia) %>%
  dplyr::group_by(data, denominazione_provincia) %>%
  dplyr::summarise(total = sum(totale_casi)) %>%
  tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>%
  dplyr::group_by() %>%
  dplyr::mutate(variazione_agrigento = Agrigento - lag(Agrigento),
                variazione_caltanissetta = Caltanissetta - lag(Caltanissetta),
                variazione_catania = Catania - lag(Catania),
                variazione_enna = Enna - lag(Enna),
                variazione_messina = Messina - lag(Messina),
                variazione_palermo = Palermo - lag(Palermo),
                variazione_ragusa = Ragusa - lag(Ragusa),
                variazione_siracusa = Siracusa - lag(Siracusa),
                variazione_trapani = Trapani - lag(Trapani)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_agrigento,
                      type = "scatter",
                      mode = "lines+markers",
                      name = "Agrigento (AG)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_caltanissetta,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Caltanissetta (CL)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_catania,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Catania (CT)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_enna,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Enna (EN)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_messina,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Messina (ME)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_palermo,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Palermo (PA)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_ragusa,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Ragusa (RG)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_siracusa,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Siracusa (SR)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_trapani,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Trapani (TR)") %>%
  plotly::layout(title = "",
                   yaxis = list(title = "Numero di casi"),
                   xaxis = list(title = ""),
                   legend = list(x = 0.3, y = 0.9),
                   hovermode = "x unified") 
#%>%  hide_legend()
     
  
```
    
    
Row
------------------------------------- 

### Andamento giornaliero RICOVERATI, IN TERAPIA INTENSIVA e IN ISOLAMENTO DOMICILIARE in SICILIA (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}
df_italy_region %>%
  dplyr::filter(denominazione_regione == "Sicilia") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ terapia_intensiva,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Ricoverati in terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ isolamento_domiciliare,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "In isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
```

### NUOVI RICOVERATI, NUOVI IN TERAPIA INTENSIVA e NUOVI IN ISOLAMENTO DOMICILIARE in SICILIA (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Sicilia") %>%
  arrange(data) %>%
  mutate(variazione_ricoverati_con_sintomi = ricoverati_con_sintomi - lag(ricoverati_con_sintomi),
         Rate_percent_ricoverati_con_sintomi = (variazione_ricoverati_con_sintomi / ricoverati_con_sintomi)/ricoverati_con_sintomi * 100,
         variazione_terapia_intensiva = terapia_intensiva - lag(terapia_intensiva),
         Rate_percent_terapia_intensiva = (variazione_terapia_intensiva)/terapia_intensiva * 100,
         variazione_isolamento_domiciliare = isolamento_domiciliare - lag(isolamento_domiciliare),
         Rate_percent_isolamento_domiciliare = (variazione_isolamento_domiciliare)/isolamento_domiciliare * 100) %>%



plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_terapia_intensiva,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
  
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_isolamento_domiciliare,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  
      plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.2, y = 0.9),
                 hovermode = "x unified")
  
```

Row
------------------------------------- 

### Andamento giornaliero TOTALE CASI, TOTALE POSITIVI, GUARITI e DECESSI in SICILIA (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Sicilia") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_casi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale casi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ dimessi_guariti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ deceduti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
```

### NUOVI CONTAGI, VARIAZIONE TOTALE POSITIVI, NUOVI GUARITI E NUOVI DECESSI in SICILIA (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Sicilia") %>%
  arrange(as.Date(data)) %>%
  mutate(variazione_dimessi_guariti = dimessi_guariti - lag(dimessi_guariti),
         #Rate_percent_dimessi_guariti = (variazione_dimessi_guariti)/dimessi_guariti * 100,
         variazione_deceduti = deceduti - lag(deceduti)) %>%
         #Rate_percent_deceduti = (variazione_deceduti)/deceduti * 100,
         #variazione_totale_casi = totale_casi - lag(totale_casi),
         #Rate_percent_totale_casi = (variazione_totale_casi)/totale_casi * 100) %>%
plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_dimessi_guariti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_deceduti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
    plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

LOMBARDIA
=====================================  
Row
-------------------------------------
### Casi totali in Lombardia {.value-box}

```{r}
valueBox(value = paste(format(df_italy_region_latest[9, 18], big.mark = "."), "", sep = " "),
         caption = "Totale casi", 
         icon = "fas fa-user-md",
         color = casi_totali_color)
```

### Positivi {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[9, 11], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[9, 11]) / sum(df_italy_region_latest[9, 18]), 1), "%)", "", sep = " "),
         caption = "Totale positivi", 
         icon = "fas fa-user-md", 
         color = positivi_color)
```

### Guariti {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[9, 14], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[9, 14]) / sum(df_italy_region_latest[9, 18]), 1), "%)", "", sep = " "),
         caption = "Totale guariti", 
         icon = "fas fa-heartbeat", 
         color = guariti_color)

```

### Decesssi {.value-box}

```{r}
valueBox(value = paste(format(df_italy_region_latest[9, 15], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[9, 15]) / sum(df_italy_region_latest[9, 18]), 1), "%)", "", sep = " "),
         caption = "Totale deceduti", 
         icon = "fas fa-heart-broken", 
         color = deceduti_color)
```

Row {data-height=400}
-------------------------------------

### Distribuzione TOTALE CASI PROVINCIE LOMBARDE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_province %>% 
  dplyr::filter(denominazione_regione == "Lombardia") %>%
  dplyr::group_by(data,denominazione_provincia, totale_casi) %>%
  #dplyr::filter(data == as.Date(Sys.Date()-1)) %>%
  #dplyr::summarise(total = sum(totale_casi)) %>%
  #tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>%
  plot_ly(labels = ~ denominazione_provincia, values = ~ totale_casi, 
          textposition = 'inside',
          textinfo = 'label+percent',
          insidetextfont = list(color = '#FFFFFF'),
          type = 'pie') %>%
  layout(title = '',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE)) %>% 
  hide_legend()

#   df_italy_province %>% 
#   dplyr::filter(denominazione_regione == "Lombardia") %>%
#   dplyr::group_by(data,denominazione_provincia, totale_casi) %>%
#   dplyr::filter(data == as.Date(Sys.Date()-1)) %>%
#   dplyr::summarise(total = sum(totale_casi)) %>%
#   dplyr::arrange(-totale_casi) %>%
# plotly::plot_ly(labels = ~ denominazione_provincia, values = ~ totale_casi, 
#           textinfo="label+percent") %>%
# #plotly::plot_ly(data = df_italy_province_latest[49:60, c(6, 10)]) %>%
#   plotly::add_trace(x = ~ denominazione_provincia,
#                   y = ~ totale_casi,
#                   text = ~ totale_casi,
#                   textposition = 'auto') %>%
#   plotly::layout(yaxis = list(title = "Numero di casi"),
#                  type = "bar",
#                  #barmode = "stack",
#                  xaxis = list(title = "",
#                  categoryorder = "array",
#                  categoryarray = ~ totale_casi))

```

### NUOVI CONTAGI in LOMBARDIA (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lombardia") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                  y = ~ nuovi_positivi,
                  text = ~ nuovi_positivi,
                  textposition = 'auto',
                  name = "Nuovi contagi",
                  line = list(color = casi_totali_color),
                  marker = list(color = casi_totali_color),
                  type = "scatter", mode = "lines+markers") %>%
    plotly::layout(yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = "", hovermode = "x unified",
     categoryorder = "array",
     categoryarray = ~ nuovi_positivi))
  
```
    
Row {data-height=400}
-------------------------------------
    
### NUOVI CONTAGI, NUOVI TAMPONI, NUOVI CASI TESTATI in LOMBARDIA (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lombardia") %>%
  dplyr::mutate(variazione_casi_testati = casi_testati - lag(casi_testati), 
                variazione_tamponi = tamponi - lag(tamponi),
                variazione_nuovi_positivi = nuovi_positivi - lag(nuovi_positivi)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_casi_testati,
                    text = ~ variazione_casi_testati,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Casi testati giornalieri",
                    line = list(color = casi_testati_color),
                    marker = list(color = casi_testati_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_tamponi,
                    text = ~ variazione_tamponi,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Tamponi giornalieri",
                    line = list(color = tamponi_color),
                    marker = list(color = tamponi_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    text = ~ nuovi_positivi,
                    hovertemplate = "%{y}",
                    textposition = 'auto',
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  # plotly::add_trace(x = ~ as.Date(data),
  #                   y = ~ variazione_totale_positivi,
  #                   text = ~ variazione_totale_positivi,
  #                   hovertemplate = "%{y}",
  #                   textposition = 'auto',
  #                   name = "Variazione totale positivi",
  #                   line = list(color = positivi_color),
  #                   marker = list(color = positivi_color),
  #                   type = "scatter", mode = "lines+markers") %>%
  
  plotly::layout(title = "",
                 yaxis = list(title = ""),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```

### NUOVI CONTAGI PROVINCE LOMBARDE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_province %>%
  dplyr::filter(denominazione_regione == "Lombardia") %>%
  dplyr::arrange(denominazione_provincia) %>%
  dplyr::group_by(data, denominazione_provincia) %>%
  dplyr::summarise(total = sum(totale_casi)) %>%
  tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>% 
  dplyr::group_by() %>% rename(MonzaBrianza = "Monza e della Brianza") %>%
  dplyr::mutate(variazione_bergamo = Bergamo - lag(Bergamo),
                variazione_brescia = Brescia - lag(Brescia),
                variazione_como = Como - lag(Como),
                variazione_cremona = Cremona - lag(Cremona),
                variazione_lecco = Lecco - lag(Lecco),
                variazione_lodi = Lodi - lag(Lodi),
                variazione_mantova = Mantova - lag(Mantova),
                variazione_milano = Milano - lag(Milano), 
                variazione_monza_brianza = MonzaBrianza - lag(MonzaBrianza), 
                variazione_pavia = Pavia - lag(Pavia),
                variazione_sondrio = Sondrio - lag(Sondrio),
                variazione_varese = Varese - lag(Varese)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_bergamo,
                      type = "scatter",
                      mode = "lines+markers",
                      name = "Bergamo (BG)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_brescia,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Brescia (BS)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_como,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Como (CO)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_cremona,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Cremona (CR)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_lecco,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Lecco (LC)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_lodi,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Lodi (LO)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_mantova,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Mantova (MN)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_milano,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Milano (MI)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_monza_brianza,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Monza-Brianza (MB)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_pavia,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Pavia (PV)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_sondrio,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Sondrio (SO)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_varese,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Varese (Va)") %>%
  plotly::layout(showlegend = FALSE,
    #title = "",
    #legend = list(x = 0.7, y = 0.9),
    yaxis = list(title = "Nuovi contagi"),
    xaxis = list(title = ""),
    hovermode = "x unified"
    #margin = list(l = 60,r = 40,b = 10,t = 10,pad = 2)
  )


```

Row
-------------------------------------

### Andamento giornaliero RICOVERATI, IN TERAPIA INTENSIVA e IN ISOLAMENTO DOMICILIARE in LOMBARDIA (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lombardia") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ terapia_intensiva,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Ricoverati in terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ isolamento_domiciliare,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "In isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```

### NUOVI RICOVERATI, NUOVI IN TERAPIA INTENSIVA e NUOVI IN ISOLAMENTO DOMICILIARE in LOMBARDIA (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lombardia") %>%
  arrange(data) %>%
  mutate(variazione_ricoverati_con_sintomi = ricoverati_con_sintomi - lag(ricoverati_con_sintomi),
        # Rate_percent_ricoverati_con_sintomi = (variazione_ricoverati_con_sintomi / ricoverati_con_sintomi)/ricoverati_con_sintomi * 100,
         variazione_terapia_intensiva = terapia_intensiva - lag(terapia_intensiva),
         #Rate_percent_terapia_intensiva = (variazione_terapia_intensiva)/terapia_intensiva * 100,
         variazione_isolamento_domiciliare = isolamento_domiciliare - lag(isolamento_domiciliare)) %>%
         #Rate_percent_isolamento_domiciliare = (variazione_isolamento_domiciliare)/isolamento_domiciliare * 100) %>%



plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_terapia_intensiva,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
  
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_isolamento_domiciliare,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  
      plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

Row
------------------------------------- 

### Andamento giornaliero TOTALE CASI, TOTALE POSITIVI, GUARITI e DECESSI in SICILIA in LOMBARDIA (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lombardia") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_casi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale casi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ dimessi_guariti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ deceduti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```

### NUOVI POSITIV, VARIAZIONE TOTALE POSITIVI, NUOVI GUARITI E NUOVI DECESSI in LOMBARDIA (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lombardia") %>%
  arrange(as.Date(data)) %>%
  mutate(variazione_dimessi_guariti = dimessi_guariti - lag(dimessi_guariti),
         Rate_percent_dimessi_guariti = (variazione_dimessi_guariti)/dimessi_guariti * 100,
         variazione_deceduti = deceduti - lag(deceduti),
         Rate_percent_deceduti = (variazione_deceduti)/deceduti * 100,
         variazione_totale_casi = totale_casi - lag(totale_casi),
         Rate_percent_totale_casi = (variazione_totale_casi)/totale_casi * 100) %>%
plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_dimessi_guariti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_deceduti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
    plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

VENETO
=====================================  
Row
-------------------------------------
### Casi totali in Veneto {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[21, 18], big.mark = "."), "", sep = " "),
         caption = "Totale casi", 
         icon = "fas fa-user-md",
         color = casi_totali_color)
```

### positivi {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[21, 11], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[21, 11]) / sum(df_italy_region_latest[21, 18]), 1), "%)", "", sep = " "),
         caption = "Totale positivi", 
         icon = "fas fa-user-md", 
         color = positivi_color)
```

### guariti {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[21, 14], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[21, 14]) / sum(df_italy_region_latest[21, 18]), 1), "%)", "", sep = " "),
         caption = "Totale guariti", 
         icon = "fas fa-heartbeat", 
         color = guariti_color)

```

### deceduti {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[21, 15], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[21, 15]) / sum(df_italy_region_latest[21, 18]), 1), "%)", "", sep = " "),
         caption = "Totale deceduti", 
         icon = "fas fa-heart-broken", 
         color = deceduti_color)

```

Row {data-height=400}
-------------------------------------

### Distribuzione TOTALE CASI PROVINCIE VENETE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_province %>% 
  dplyr::filter(denominazione_regione == "Veneto") %>%
  dplyr::group_by(data,denominazione_provincia, totale_casi) %>%
  #dplyr::filter(data == as.Date(Sys.Date())-1) %>%
  #dplyr::summarise(total = sum(totale_casi)) %>%
  #tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>%
  plot_ly(labels = ~ denominazione_provincia, values = ~ totale_casi, 
          textposition = 'inside',
          textinfo = 'label+percent',
          insidetextfont = list(color = '#FFFFFF'),
          type = 'pie') %>%
  layout(title = '',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE)) %>% 
  hide_legend()


```

### NUOVI CONTAGI in VENETO (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Veneto") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                  y = ~ nuovi_positivi,
                  text = ~ nuovi_positivi,
                  textposition = 'auto',
                  name = "Nuovi contagi",
                  line = list(color = casi_totali_color),
                  marker = list(color = casi_totali_color),
                  type = "scatter", mode = "lines+markers") %>%
    plotly::layout(yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = "",
     categoryorder = "array",
     categoryarray = ~ nuovi_positivi))
  
```

Row {data-height=400}
-------------------------------------
    
### NUOVI CONTAGI, NUOVI TAMPONI, NUOVI CASI TESTATI in VENETO (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Veneto") %>%
  dplyr::mutate(variazione_casi_testati = casi_testati - lag(casi_testati), 
                variazione_tamponi = tamponi - lag(tamponi),
                variazione_nuovi_positivi = nuovi_positivi - lag(nuovi_positivi)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_casi_testati,
                    text = ~ variazione_casi_testati,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Casi testati giornalieri",
                    line = list(color = casi_testati_color),
                    marker = list(color = casi_testati_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_tamponi,
                    text = ~ variazione_tamponi,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Tamponi giornalieri",
                    line = list(color = tamponi_color),
                    marker = list(color = tamponi_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    text = ~ nuovi_positivi,
                    hovertemplate = "%{y}",
                    textposition = 'auto',
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color),
                    type = "scatter", mode = "lines+markers") %>%
  plotly::layout(title = "",
                 yaxis = list(title = ""),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```

### NUOVI CONTAGI PROVINCE VENETE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_province %>%
  dplyr::filter(denominazione_regione == "Veneto") %>%
  dplyr::arrange(denominazione_provincia) %>%
  dplyr::group_by(data, denominazione_provincia) %>%
  dplyr::summarise(total = sum(totale_casi)) %>%
  tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>%
  dplyr::group_by() %>%
  dplyr::mutate(variazione_belluno = Belluno - lag(Belluno),
                variazione_padova = Padova - lag(Padova),
                variazione_rovigo = Rovigo - lag(Rovigo),
                variazione_treviso = Treviso - lag(Treviso),
                variazione_venezia = Venezia - lag(Venezia),
                variazione_verona = Verona - lag(Verona),
                variazione_vicenza = Vicenza - lag(Vicenza)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_belluno,
                      type = "scatter",
                      mode = "lines+markers",
                      name = "Belluno (BL)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_padova,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Padova (PD)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_rovigo,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Rovigo (RO)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_treviso,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Treviso (TV)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_venezia,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Venezia (VE)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_verona,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Verona (VR)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_vicenza,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Vicenza (VI)") %>%
  plotly::layout(showlegend = FALSE,
    yaxis = list(title = "Nuovi contagi"),
    xaxis = list(title = ""),
    hovermode = "x unified")

```

Row
-------------------------------------

### Andamento giornaliero RICOVERATI, IN TERAPIA INTENSIVA e IN ISOLAMENTO DOMICILIARE in VENETO (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}
df_italy_region %>%
  dplyr::filter(denominazione_regione == "Veneto") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ terapia_intensiva,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Ricoverati in terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ isolamento_domiciliare,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "In isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
```

### NUOVI RICOVERATI, NUOVI IN TERAPIA INTENSIVA e NUOVI IN ISOLAMENTO DOMICILIARE in VENETO (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}
df_italy_region %>%
  dplyr::filter(denominazione_regione == "Veneto") %>%
  arrange(data) %>%
  mutate(variazione_ricoverati_con_sintomi = ricoverati_con_sintomi - lag(ricoverati_con_sintomi),
         Rate_percent_ricoverati_con_sintomi = (variazione_ricoverati_con_sintomi / ricoverati_con_sintomi)/ricoverati_con_sintomi * 100,
         variazione_terapia_intensiva = terapia_intensiva - lag(terapia_intensiva),
         Rate_percent_terapia_intensiva = (variazione_terapia_intensiva)/terapia_intensiva * 100,
         variazione_isolamento_domiciliare = isolamento_domiciliare - lag(isolamento_domiciliare),
         Rate_percent_isolamento_domiciliare = (variazione_isolamento_domiciliare)/isolamento_domiciliare * 100) %>%



plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_terapia_intensiva,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
  
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_isolamento_domiciliare,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  
      plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

Row
------------------------------------- 

### Andamento giornaliero TOTALE CASI, TOTALE POSITIVI, GUARITI e DECESSI in Veneto (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Veneto") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_casi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale casi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ dimessi_guariti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ deceduti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
```


### NUOVI CONTAGI, VARIAZIONE TOTALE POSITIVI, NUOVI GUARITI E NUOVI DECESSI in VENETO (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Veneto") %>%
  arrange(as.Date(data)) %>%
  mutate(variazione_dimessi_guariti = dimessi_guariti - lag(dimessi_guariti),
         #Rate_percent_dimessi_guariti = (variazione_dimessi_guariti)/dimessi_guariti * 100,
         variazione_deceduti = deceduti - lag(deceduti),
         #Rate_percent_deceduti = (variazione_deceduti)/deceduti * 100,
         variazione_totale_casi = totale_casi - lag(totale_casi)) %>%
         #Rate_percent_totale_casi = (variazione_totale_casi)/totale_casi * 100) %>%
plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_dimessi_guariti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_deceduti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
    plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

PIEMONTE
=====================================  
Row
-------------------------------------
### Casi totali in Piemonte {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[14, 18], big.mark = "."), "", sep = " "),
         caption = "Totale casi", 
         icon = "fas fa-user-md",
         color = casi_totali_color)

```

### positivi {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[14, 11], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[14, 11]) / sum(df_italy_region_latest[14, 18]), 1), "%)", "", sep = " "),
         caption = "Totale positivi", 
         icon = "fas fa-user-md", 
         color = positivi_color)

```

### guariti {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[14, 14], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[14, 14]) / sum(df_italy_region_latest[14, 18]), 1), "%)", "", sep = " "),
         caption = "Totale guariti", 
         icon = "fas fa-heartbeat", 
         color = guariti_color)

```

### deceduti {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[14, 15], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[14, 15]) / sum(df_italy_region_latest[14, 18]), 1), "%)", "", sep = " "),
         caption = "Totale deceduti", 
         icon = "fas fa-heart-broken", 
         color = deceduti_color)

```

Row {data-height=400}
-------------------------------------

### Distribuzione CASI TOTALI PROVINCIE PIEMONTESI (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_province %>% 
  dplyr::filter(denominazione_regione == "Piemonte") %>%
  dplyr::group_by(data,denominazione_provincia, totale_casi) %>%
  #dplyr::filter(data == as.Date(Sys.Date()-1)) %>%
  #dplyr::summarise(total = sum(totale_casi)) %>%
  #tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>%
  plot_ly(labels = ~ denominazione_provincia, values = ~ totale_casi, 
          textposition = 'inside',
          textinfo = 'label+percent',
          insidetextfont = list(color = '#FFFFFF'),
          type = 'pie') %>%
  layout(title = '',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE)) %>% 
  hide_legend()

#   df_italy_province %>% 
#   dplyr::filter(denominazione_regione == "Piemonte") %>%
#   dplyr::group_by(data,denominazione_provincia, totale_casi) %>%
#   dplyr::filter(data == as.Date(Sys.Date()-1)) %>%
#   dplyr::summarise(total = sum(totale_casi)) %>%
#   dplyr::arrange(-totale_casi) %>%
# plotly::plot_ly(labels = ~ denominazione_provincia, values = ~ totale_casi, 
#           textinfo="label+percent") %>%
# #plotly::plot_ly(data = df_italy_province_latest[71:78, c(6, 10)]) %>%
#   plotly::add_trace(x = ~ denominazione_provincia,
#                   y = ~ totale_casi,
#                   text = ~ totale_casi,
#                   textposition = 'auto') %>%
#   plotly::layout(yaxis = list(title = "Numero di casi"),
#                  type = "bar",
#                  #barmode = "stack",
#                  xaxis = list(title = "",
#                  categoryorder = "array",
#                  categoryarray = ~ totale_casi))

```

### NUOVI CONTAGI in PIEMONTE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Piemonte") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                  y = ~ nuovi_positivi,
                  text = ~ nuovi_positivi,
                  textposition = 'auto',
                  name = "Nuovi contagi",
                  line = list(color = casi_totali_color),
                  marker = list(color = casi_totali_color),
                  type = "scatter", mode = "lines+markers") %>%
    plotly::layout(yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = "",
     categoryorder = "array",
     categoryarray = ~ variazione_totale_positivi))
  
```


Row {data-height=400}
-------------------------------------
    
### NUOVI CONTAGI, NUOVI TAMPONI, NUOVI CASI TESTATI in PIEMONTE (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Piemonte") %>%
  dplyr::mutate(variazione_casi_testati = casi_testati - lag(casi_testati), 
                variazione_tamponi = tamponi - lag(tamponi),
                variazione_nuovi_positivi = nuovi_positivi - lag(nuovi_positivi)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_casi_testati,
                    text = ~ variazione_casi_testati,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Casi testati giornalieri",
                    line = list(color = casi_testati_color),
                    marker = list(color = casi_testati_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_tamponi,
                    text = ~ variazione_tamponi,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Tamponi giornalieri",
                    line = list(color = tamponi_color),
                    marker = list(color = tamponi_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    text = ~ nuovi_positivi,
                    hovertemplate = "%{y}",
                    textposition = 'auto',
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color),
                    type = "scatter", mode = "lines+markers") %>%
  plotly::layout(title = "",
                 yaxis = list(title = ""),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```

### NUOVI CONTAGI PROVINCE PIEMONTE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_province %>%
  dplyr::filter(denominazione_regione == "Piemonte") %>%
  dplyr::arrange(denominazione_provincia) %>%
  dplyr::group_by(data, denominazione_provincia) %>%
  dplyr::summarise(total = sum(totale_casi)) %>%
  tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>%
  dplyr::group_by() %>% 
  rename(Verbania = "Verbano-Cusio-Ossola") %>%
  dplyr::mutate(variazione_alessandria = Alessandria - lag(Alessandria),
                variazione_asti = Asti - lag(Asti),
                variazione_biella = Biella - lag(Biella),
                variazione_cuneo = Cuneo - lag(Cuneo),
                variazione_novara = Novara - lag(Novara),
                variazione_torino = Torino - lag(Torino),
                variazione_verbania = Verbania - lag(Verbania),
                variazione_vercelli = Vercelli - lag(Vercelli)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_alessandria,
                      type = "scatter",
                      mode = "lines+markers",
                      name = "Alessandria (AL)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_asti,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Asti (AT)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_biella,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Biella (BI)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_cuneo,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Cuneo (CN)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_novara,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Novara (NO)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_torino,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Torino (TO)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_verbania,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Verbano-Cusio-Ossola (VB)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_vercelli,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Vercelli (VC)") %>%
  plotly::layout(showlegend = FALSE,
    yaxis = list(title = "Nuovi contagi"),
    xaxis = list(title = ""),
    hovermode = "x unified")

```


Row
-------------------------------------

### Andamento giornaliero RICOVERATI, IN TERAPIA INTENSIVA e IN ISOLAMENTO DOMICILIARE in PIEMONTE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Piemonte") %>% 
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ terapia_intensiva,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Ricoverati in terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ isolamento_domiciliare,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "In isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```

### NUOVI RICOVERATI, NUOVI IN TERAPIA INTENSIVA e NUOVI IN ISOLAMENTO DOMICILIARE in PIEMONTE (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Piemonte") %>%
  arrange(data) %>%
  mutate(variazione_ricoverati_con_sintomi = ricoverati_con_sintomi - lag(ricoverati_con_sintomi),
         #Rate_percent_ricoverati_con_sintomi = (variazione_ricoverati_con_sintomi / ricoverati_con_sintomi)/ricoverati_con_sintomi * 100,
         variazione_terapia_intensiva = terapia_intensiva - lag(terapia_intensiva),
         #Rate_percent_terapia_intensiva = (variazione_terapia_intensiva)/terapia_intensiva * 100,
         variazione_isolamento_domiciliare = isolamento_domiciliare - lag(isolamento_domiciliare)) %>%
         #Rate_percent_isolamento_domiciliare = (variazione_isolamento_domiciliare)/isolamento_domiciliare * 100) %>%
plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_terapia_intensiva,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi in terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
  
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_isolamento_domiciliare,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi in isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  
      plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

Row
------------------------------------- 

### Andamento giornaliero TOTALE CASI, TOTALE POSITIVI, GUARITI e DECESSI in PIEMONTE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Piemonte") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_casi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale casi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ dimessi_guariti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ deceduti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```

### NUOVI CONTAGI, VARIAZIONE TOTALE POSITIVI, NUOVI GUARITI E NUOVI DECESSI in PIEMONTE (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Piemonte") %>%
  arrange(as.Date(data)) %>%
  mutate(variazione_dimessi_guariti = dimessi_guariti - lag(dimessi_guariti),
         #Rate_percent_dimessi_guariti = (variazione_dimessi_guariti)/dimessi_guariti * 100,
         variazione_deceduti = deceduti - lag(deceduti),
         #Rate_percent_deceduti = (variazione_deceduti)/deceduti * 100,
         variazione_totale_casi = totale_casi - lag(totale_casi)) %>%
         #Rate_percent_totale_casi = (variazione_totale_casi)/totale_casi * 100) %>%
plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_dimessi_guariti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_deceduti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
    plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

LAZIO
=====================================  
Row
-------------------------------------
### Casi totali in Lazio {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[7, 18], big.mark = "."), "", sep = " "),
         caption = "Totale casi", 
         icon = "fas fa-user-md",
         color = casi_totali_color)
```

### positivi {.value-box}

```{r}

valueBox(value = paste(format(df_italy_region_latest[7, 11], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[7, 11]) / sum(df_italy_region_latest[7, 18]), 1), "%)", "", sep = " "),
         caption = "Totale positivi", 
         icon = "fas fa-user-md", 
         color = positivi_color)
```

### guariti {.value-box}

```{r}
valueBox(value = paste(format(df_italy_region_latest[7, 14], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[7, 14]) / sum(df_italy_region_latest[7, 18]), 1), "%)", "", sep = " "),
         caption = "Totale guariti", 
         icon = "fas fa-heartbeat", 
         color = guariti_color)
```

### deceduti {.value-box}

```{r}
valueBox(value = paste(format(df_italy_region_latest[7, 15], big.mark = "."),
                       " (", round(100 * sum(df_italy_region_latest[7, 15]) / sum(df_italy_region_latest[7, 18]), 1), "%)", "", sep = " "),
         caption = "Totale deceduti", 
         icon = "fas fa-heart-broken", 
         color = deceduti_color)
```

Row {data-height=400}
-------------------------------------

### Distribuzione TOTALE CASI PROVINCIE LAZIALI (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_province %>% 
  dplyr::filter(denominazione_regione == "Lazio") %>%
  dplyr::group_by(data,denominazione_provincia, totale_casi) %>%
  #dplyr::filter(data == as.Date(Sys.Date()-1)) %>%
  #dplyr::summarise(total = sum(totale_casi)) %>%
  #tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>%
  plot_ly(labels = ~ denominazione_provincia, values = ~ totale_casi, 
          textposition = 'inside',
          textinfo = 'label+percent',
          insidetextfont = list(color = '#FFFFFF'),
          type = 'pie') %>%
  layout(title = '',
         xaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE),
         yaxis = list(showgrid = FALSE, zeroline = FALSE, showticklabels = FALSE)) %>% 
  hide_legend()


#  df_italy_province %>% 
#   dplyr::filter(denominazione_regione == "Lazio") %>%
#   dplyr::group_by(data,denominazione_provincia, totale_casi) %>%
#   dplyr::filter(data == as.Date(Sys.Date()-1)) %>%
#   dplyr::summarise(total = sum(totale_casi)) %>%
#   dplyr::arrange(-totale_casi) %>%
# plotly::plot_ly(labels = ~ denominazione_provincia, values = ~ totale_casi, 
#           textinfo="label+percent") %>%
# #plotly::plot_ly(data = df_italy_province_latest[38:42, c(6, 10)]) %>%
#   plotly::add_trace(x = ~ denominazione_provincia,
#                   y = ~ totale_casi,
#                   text = ~ totale_casi,
#                   textposition = 'auto') %>%
#   plotly::layout(yaxis = list(title = "Numero di casi"),
#                  type = "bar",
#                  #barmode = "stack",
#                  xaxis = list(title = "",
#                  categoryorder = "array",
#                  categoryarray = ~ totale_casi))

```

### NUOVI CONTAGI in LAZIO (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lazio") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>% 
  plotly::add_trace(x = ~ as.Date(data),
                  y = ~ nuovi_positivi,
                  text = ~ nuovi_positivi,
                  textposition = 'auto',
                  name = "Nuovi contagi",
                  line = list(color = casi_totali_color),
                  marker = list(color = casi_totali_color),
                  type = "scatter", mode = "lines+markers") %>%
    plotly::layout(yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = "",
     categoryorder = "array",
     categoryarray = ~ variazione_totale_positivi))
  
```


Row {data-height=400}
-------------------------------------
    
### NUOVI CONTAGI, NUOVI TAMPONI, NUOVI CASI TESTATI nel LAZIO (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lazio") %>%
  dplyr::mutate(variazione_casi_testati = casi_testati - lag(casi_testati), 
                variazione_tamponi = tamponi - lag(tamponi),
                variazione_nuovi_positivi = nuovi_positivi - lag(nuovi_positivi)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_casi_testati,
                    text = ~ variazione_casi_testati,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Casi testati giornalieri",
                    line = list(color = casi_testati_color),
                    marker = list(color = casi_testati_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_tamponi,
                    text = ~ variazione_tamponi,
                    hovertemplate = "%{text}",
                    textposition = 'auto',
                    name = "Tamponi giornalieri",
                    line = list(color = tamponi_color),
                    marker = list(color = tamponi_color),
                    type = "scatter", mode = "lines+markers") %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    text = ~ nuovi_positivi,
                    hovertemplate = "%{y}",
                    textposition = 'auto',
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color),
                    type = "scatter", mode = "lines+markers") %>%
  plotly::layout(title = "",
                 yaxis = list(title = ""),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```

### NUOVI CONTAGI PROVINCE LAZIO (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_province %>%
  dplyr::filter(denominazione_regione == "Lazio") %>%
  dplyr::arrange(denominazione_provincia) %>%
  dplyr::group_by(data, denominazione_provincia) %>%
  dplyr::summarise(total = sum(totale_casi)) %>%
  tidyr::pivot_wider(names_from = denominazione_provincia, values_from = total) %>%
  dplyr::group_by() %>%
  dplyr::mutate(variazione_frosinone = Frosinone - lag(Frosinone),
                variazione_latina = Latina - lag(Latina),
                variazione_rieti = Rieti - lag(Rieti),
                variazione_roma = Roma - lag(Roma),
                variazione_viterbo = Viterbo - lag(Viterbo)) %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_frosinone,
                      type = "scatter",
                      mode = "lines+markers",
                      name = "Frosinone (FR)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_latina,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Latina (LT)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                      y = ~ variazione_rieti,
                      type = "scatter",
                      mode = 'lines+markers',
                      name = "Rieti (RI)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_roma,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Roma (RM)") %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_viterbo,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Viterbo (VT)") %>%
  plotly::layout(showlegend = FALSE,
    yaxis = list(title = "Nuovi contagi"),
    xaxis = list(title = ""),
    hovermode = "x unified")

```

Row
-------------------------------------

### Andamento giornaliero RICOVERATI, IN TERAPIA INTENSIVA e IN ISOLAMENTO DOMICILIARE nel LAZIO (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lazio") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ terapia_intensiva,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Ricoverati in terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ isolamento_domiciliare,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "In isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
```

### NUOVI RICOVERATI, NUOVI IN TERAPIA INTENSIVA e NUOVI IN ISOLAMENTO DOMICILIARE nel LAZIO (`r  max(as.Date(coronavirus$Last_Update))`)
    
```{r}
df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lazio") %>%
  arrange(data) %>%
  mutate(variazione_ricoverati_con_sintomi = ricoverati_con_sintomi - lag(ricoverati_con_sintomi),
         Rate_percent_ricoverati_con_sintomi = (variazione_ricoverati_con_sintomi / ricoverati_con_sintomi)/ricoverati_con_sintomi * 100,
         variazione_terapia_intensiva = terapia_intensiva - lag(terapia_intensiva),
         Rate_percent_terapia_intensiva = (variazione_terapia_intensiva)/terapia_intensiva * 100,
         variazione_isolamento_domiciliare = isolamento_domiciliare - lag(isolamento_domiciliare),
         Rate_percent_isolamento_domiciliare = (variazione_isolamento_domiciliare)/isolamento_domiciliare * 100) %>%



plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_ricoverati_con_sintomi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione ricoverati con sintomi",
                    line = list(color = ricoverati_color),
                    marker = list(color = ricoverati_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_terapia_intensiva,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione terapia intensiva",
                    line = list(color = terapia_color),
                    marker = list(color = terapia_color)) %>%
  
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_isolamento_domiciliare,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione isolamento domiciliare",
                    line = list(color = isolamento_color),
                    marker = list(color = isolamento_color)) %>%
  
      plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

Row
------------------------------------- 

### Andamento giornaliero TOTALE CASI, TOTALE POSITIVI, GUARITI e DECESSI in LAZIO (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lazio") %>%
  plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_casi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale casi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ dimessi_guariti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
plotly::add_trace(x = ~ as.Date(data),
                    y = ~ deceduti,
                    type = "scatter",
                    mode = 'lines+markers',
                    name = "Decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
  plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")

```

### NUOVI CONTAGI, VARIAZIONE TOTALE POSITIVI, NUOVI GUARITI E NUOVI DECESSI in LAZIO (`r  max(as.Date(coronavirus$Last_Update))`)

```{r}

df_italy_region %>%
  dplyr::filter(denominazione_regione == "Lazio") %>%
  arrange(as.Date(data)) %>%
  mutate(variazione_dimessi_guariti = dimessi_guariti - lag(dimessi_guariti),
         #Rate_percent_dimessi_guariti = (variazione_dimessi_guariti)/dimessi_guariti * 100,
         variazione_deceduti = deceduti - lag(deceduti)) %>%
         #Rate_percent_deceduti = (variazione_deceduti)/deceduti * 100,
         #variazione_totale_casi = totale_casi - lag(totale_casi),
         #Rate_percent_totale_casi = (variazione_totale_casi)/totale_casi * 100) %>%
plotly::plot_ly() %>% config(displayModeBar = FALSE) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_totale_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Variazione totale positivi",
                    line = list(color = positivi_color),
                    marker = list(color = positivi_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ nuovi_positivi,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi contagi",
                    line = list(color = casi_totali_color),
                    marker = list(color = casi_totali_color)) %>%
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_dimessi_guariti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi guariti",
                    line = list(color = guariti_color),
                    marker = list(color = guariti_color)) %>%
  
  plotly::add_trace(x = ~ as.Date(data),
                    y = ~ variazione_deceduti,
                    type = "scatter",
                    mode = "lines+markers",
                    name = "Nuovi decessi",
                    line = list(color = deceduti_color),
                    marker = list(color = deceduti_color)) %>%
    plotly::layout(title = "",
                 yaxis = list(title = "Numero di casi"),
                 xaxis = list(title = ""),
                 legend = list(x = 0.1, y = 0.9),
                 hovermode = "x unified")
  
```

INFO
=======================================================================

**Coronavirus in Italia**

Questa dashboard offre una panoramica dell'epidemia di Coronavirus COVID-19 in Italia. E' costruita con R utilizzando il framework R Markdown ed  stata adattata dalla dashboard di Rami Krispin. (https://ramikrispin.github.io/coronavirus_dashboard/)


**Dati**

I dati sono quelli messi a disposizione dal Ministero della Salute (https://github.com/pcm-dpc/COVID-19) e dalla repository del Johns Hopkins University Center for Systems Science and Engineering (JHU CCSE). (https://github.com/RamiKrispin/coronavirus-csv)

I dati e la dashboard vengono aggiornati su base giornaliera.


**Contatto**

Per qualsiasi domanda o feedback, puoi contattarmi su http://www.enzoalbanese.it. Maggiori informazioni su questa dashboard sono disponibili in questo articolo: https://www.statsandr.com/blog/how-to-create-a-simple-coronavirus-dashboard-specific-to-your-country-in-r/